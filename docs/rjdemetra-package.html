<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Topic 7 RJDemetra package | Time Series for Official Statistics</title>
  <meta name="description" content="Time Series methods for Official Statistics" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Topic 7 RJDemetra package | Time Series for Official Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Time Series methods for Official Statistics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Topic 7 RJDemetra package | Time Series for Official Statistics" />
  
  <meta name="twitter:description" content="Time Series methods for Official Statistics" />
  

<meta name="author" content="Alessandro Ciancetta and Daniele Colombo" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="illustrative-example.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">EurostatTimeSeries</a></li>
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-time-series-analysis.html"><a href="introduction-to-time-series-analysis.html"><i class="fa fa-check"></i><b>1</b> Introduction to Time Series Analysis</a></li>
<li class="chapter" data-level="2" data-path="arma-modeling-an-overview.html"><a href="arma-modeling-an-overview.html"><i class="fa fa-check"></i><b>2</b> ARMA modeling: an overview</a></li>
<li class="chapter" data-level="3" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>3</b> 1) INTRODUCTION</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction.html"><a href="introduction.html#time-series"><i class="fa fa-check"></i><b>3.1</b> Time series</a></li>
<li class="chapter" data-level="3.2" data-path="introduction.html"><a href="introduction.html#acf-and-pacf"><i class="fa fa-check"></i><b>3.2</b> ACF and PACF</a></li>
<li class="chapter" data-level="3.3" data-path="introduction.html"><a href="introduction.html#stationarity"><i class="fa fa-check"></i><b>3.3</b> Stationarity</a></li>
<li class="chapter" data-level="3.4" data-path="introduction.html"><a href="introduction.html#an-important-stationary-series-the-white-noise-process"><i class="fa fa-check"></i><b>3.4</b> An important stationary series: the white noise process</a></li>
<li class="chapter" data-level="3.5" data-path="introduction.html"><a href="introduction.html#making-a-time-series-stationary"><i class="fa fa-check"></i><b>3.5</b> Making a time series stationary</a></li>
<li class="chapter" data-level="3.6" data-path="introduction.html"><a href="introduction.html#wold-representation"><i class="fa fa-check"></i><b>3.6</b> Wold representation</a></li>
<li class="chapter" data-level="3.7" data-path="introduction.html"><a href="introduction.html#ar1"><i class="fa fa-check"></i><b>3.7</b> AR(1)</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="introduction.html"><a href="introduction.html#estimation-and-prediction"><i class="fa fa-check"></i><b>3.7.1</b> Estimation and prediction</a></li>
<li class="chapter" data-level="3.7.2" data-path="introduction.html"><a href="introduction.html#real-world-example-gdp-series"><i class="fa fa-check"></i><b>3.7.2</b> Real world example: GDP series</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="introduction.html"><a href="introduction.html#arp"><i class="fa fa-check"></i><b>3.8</b> AR(p)</a></li>
<li class="chapter" data-level="3.9" data-path="introduction.html"><a href="introduction.html#ma1"><i class="fa fa-check"></i><b>3.9</b> MA(1)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="a-caucus-race-and-a-long-tale.html"><a href="a-caucus-race-and-a-long-tale.html"><i class="fa fa-check"></i><b>4</b> A caucus-race and a long tale</a></li>
<li class="chapter" data-level="5" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>5</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="introduction-1.html"><a href="introduction-1.html#the-components-of-a-time-series"><i class="fa fa-check"></i><b>5.0.1</b> The components of a time series</a></li>
<li class="chapter" data-level="5.0.2" data-path="introduction-1.html"><a href="introduction-1.html#the-causes-of-seasonality"><i class="fa fa-check"></i><b>5.0.2</b> The causes of seasonality</a></li>
<li class="chapter" data-level="5.0.3" data-path="introduction-1.html"><a href="introduction-1.html#why-to-adjust-for-seasonality"><i class="fa fa-check"></i><b>5.0.3</b> Why to adjust for seasonality</a></li>
<li class="chapter" data-level="5.1" data-path="introduction-1.html"><a href="introduction-1.html#decomposition-models"><i class="fa fa-check"></i><b>5.1</b> Decomposition models</a></li>
<li class="chapter" data-level="5.2" data-path="introduction-1.html"><a href="introduction-1.html#official-programs-for-seasonal-adjustment"><i class="fa fa-check"></i><b>5.2</b> Official programs for seasonal adjustment</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="illustrative-example.html"><a href="illustrative-example.html"><i class="fa fa-check"></i><b>6</b> Illustrative example</a></li>
<li class="chapter" data-level="7" data-path="rjdemetra-package.html"><a href="rjdemetra-package.html"><i class="fa fa-check"></i><b>7</b> RJDemetra package</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rjdemetra-package.html"><a href="rjdemetra-package.html#preprocessing"><i class="fa fa-check"></i><b>7.1</b> Preprocessing</a></li>
<li class="chapter" data-level="7.2" data-path="rjdemetra-package.html"><a href="rjdemetra-package.html#decomposition"><i class="fa fa-check"></i><b>7.2</b> Decomposition</a></li>
<li class="chapter" data-level="7.3" data-path="rjdemetra-package.html"><a href="rjdemetra-package.html#additional-output-and-forecast"><i class="fa fa-check"></i><b>7.3</b> Additional output and forecast</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series for Official Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rjdemetra-package" class="section level1" number="7">
<h1><span class="header-section-number">Topic 7</span> RJDemetra package</h1>
<p><strong>Remark:</strong> the RJDemetra package requires the preliminary installation of Java SE 8 (or later versions) and the R pakcage <a href="https://cran.r-project.org/package=rJava">rJava</a>.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="rjdemetra-package.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;rJava&quot;)</span></span>
<span id="cb192-2"><a href="rjdemetra-package.html#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;RJDemetra&quot;)</span></span>
<span id="cb192-3"><a href="rjdemetra-package.html#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RJDemetra)</span></code></pre></div>
<pre><code>## Warning: il pacchetto &#39;RJDemetra&#39; è stato creato con R versione 4.1.3</code></pre>
<p>To illustrate the functioning of the package we will usa the dataset embedded in it, <code>ipi_c_eu</code>, which collects monthly industrial production indices in manifacturing in the EU. The baseline year is 2015 and the series are unadjusted.</p>
<p>When using your own data, you shall transform them in a Time-Series object. Here we provide an example:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="rjdemetra-package.html#cb194-1" aria-hidden="true" tabindex="-1"></a>example_data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1943.1</span>,<span class="fl">1951.53</span>,<span class="fl">1983.23</span>,<span class="fl">1927.27</span>,<span class="fl">2054.57</span>,<span class="fl">2056.27</span>,<span class="fl">2019.18</span>,<span class="fl">2072.2</span>,<span class="fl">2069.99</span>,<span class="fl">2082.86</span>,<span class="fl">2111.94</span>,<span class="fl">2099.29</span>,<span class="fl">2094.14</span>,<span class="fl">2039.87</span>,<span class="fl">1944.41</span>,<span class="fl">2024.81</span>,<span class="fl">2080.62</span>,<span class="fl">2054.08</span>,<span class="fl">1918.6</span>,<span class="fl">1904.42</span>,<span class="fl">2021.95</span>,<span class="fl">2075.54</span>,<span class="fl">2065.55</span>,<span class="fl">2083.89</span>,<span class="fl">2148.9</span>,<span class="fl">2170.95</span>,<span class="fl">2157.69</span>,<span class="fl">2143.02</span>,<span class="fl">2164.99</span>,<span class="fl">2246.63</span>,<span class="fl">2275.12</span>,<span class="fl">2329.91</span>,<span class="fl">2366.82</span>,<span class="fl">2359.31</span>,<span class="fl">2395.35</span>,<span class="fl">2433.99</span>)</span>
<span id="cb194-2"><a href="rjdemetra-package.html#cb194-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3"><a href="rjdemetra-package.html#cb194-3" aria-hidden="true" tabindex="-1"></a>example_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(example_data, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2010</span>,<span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb194-4"><a href="rjdemetra-package.html#cb194-4" aria-hidden="true" tabindex="-1"></a>example_ts</span></code></pre></div>
<pre><code>##          Jan     Feb     Mar     Apr     May     Jun     Jul     Aug     Sep     Oct     Nov     Dec
## 2010 1943.10 1951.53 1983.23 1927.27 2054.57 2056.27 2019.18 2072.20 2069.99 2082.86 2111.94 2099.29
## 2011 2094.14 2039.87 1944.41 2024.81 2080.62 2054.08 1918.60 1904.42 2021.95 2075.54 2065.55 2083.89
## 2012 2148.90 2170.95 2157.69 2143.02 2164.99 2246.63 2275.12 2329.91 2366.82 2359.31 2395.35 2433.99</code></pre>
<p>We take as an example the data for France from <code>ipi_c_eu</code>:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="rjdemetra-package.html#cb196-1" aria-hidden="true" tabindex="-1"></a>ipi_fr <span class="ot">&lt;-</span> ipi_c_eu[,<span class="st">&quot;FR&quot;</span>]  </span>
<span id="cb196-2"><a href="rjdemetra-package.html#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ipi_fr)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<p>As explained in the first section, the two most common procedures are the X-13ARIMA-SEATS method and the TRAMO-SEATS method. They both consist of two linked parts: the preprocessing step and the decomposition step. The first is common to both procedures and is based on fitting a RegARIMA model to estimate the effect of trading day variations and outliers and remove them from the original series.</p>
<div id="preprocessing" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Preprocessing</h2>
<p>The RegARIMA model (model with ARIMA errors) is specified as</p>
<p><span class="math display">\[
z_t=y_t \cdot \beta+x_t
\]</span>
where</p>
<p>• <span class="math inline">\(z_t\)</span> is the original series;</p>
<p>• <span class="math inline">\(β = (β_1, ..., β_n)\)</span> is a vector of regression coefficients;</p>
<p>• <span class="math inline">\(y_t = (y_{1t}, ..., y_{nt})\)</span> are <span class="math inline">\(n\)</span> regression variables (outliers, calendar effects, user-defined variables);</p>
<p>• <span class="math inline">\(x_t\)</span> is a disturbance that follows the general ARIMA process.</p>
<p>Note that the automatically identified specification of the RegARIMA model might differ between X-13 and TRAMO-SEATS (meaning that the number of RA or MA components can be different) but the fitting procedure is the same.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="rjdemetra-package.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">x13</span>(ipi_fr)<span class="sc">$</span>regarima</span></code></pre></div>
<pre><code>## y = regression model + arima (2, 1, 1, 0, 1, 1)
## Log-transformation: no
## Coefficients:
##             Estimate Std. Error
## Phi(1)     0.0003269      0.108
## Phi(2)     0.1688192      0.074
## Theta(1)  -0.5485606      0.102
## BTheta(1) -0.6660849      0.042
## 
##               Estimate Std. Error
## Monday         0.55932      0.228
## Tuesday        0.88221      0.228
## Wednesday      1.03996      0.229
## Thursday       0.04943      0.229
## Friday         0.91132      0.230
## Saturday      -1.57769      0.228
## Leap year      2.15403      0.705
## Easter [1]    -2.37950      0.454
## TC (4-2020)  -35.59245      2.173
## AO (3-2020)  -20.89026      2.180
## AO (5-2011)   13.49850      1.857
## LS (11-2008) -12.54901      1.636
## 
## 
## Residual standard error: 2.218 on 342 degrees of freedom
## Log likelihood = -799.1, aic =  1632 aicc =  1634, bic(corrected for length) = 1.855</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="rjdemetra-package.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tramoseats</span>(ipi_fr)<span class="sc">$</span>regarima</span></code></pre></div>
<pre><code>## y = regression model + arima (2, 1, 0, 0, 1, 1)
## Log-transformation: no
## Coefficients:
##           Estimate Std. Error
## Phi(1)      0.4032      0.051
## Phi(2)      0.2883      0.051
## BTheta(1)  -0.6641      0.042
## 
##             Estimate Std. Error
## Week days     0.6994      0.032
## Leap year     2.3231      0.690
## Easter [6]   -2.5154      0.436
## AO (5-2011)  13.4679      1.787
## TC (4-2020) -22.2128      2.205
## TC (3-2020) -21.0391      2.217
## AO (5-2000)   6.7386      1.794
## 
## 
## Residual standard error: 2.326 on 348 degrees of freedom
## Log likelihood = -816.1, aic =  1654 aicc =  1655, bic(corrected for length) = 1.852</code></pre>
<p>As we can see, the functions <code>x13</code> and <code>tramoseats</code> automatically fit the best RegARIMA model for the given time series. For the regressive part (<span class="math inline">\(y_t\)</span>), the functions include several dummy variables to check for the effects of the weekdays (Monday-Saturday) and outliers. The outliers are reported in parentheses and classified according to their type (Additive Outliers, Transitory Change, Level Shift). The ARIMA model is automatically selected to best fit the data, by choosing the number of autoregressive and moving average components (both regular and seasonal). Regular components are constrained to be at most 3, while seasonal components can be at most 1 per type. The frequency of observations per year (that is, the number of observations per year) is automatically detected. The output reports the estimated coefficients and the standard errors.</p>
</div>
<div id="decomposition" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Decomposition</h2>
<p>The second part instead differs across the two procedures. X-13 is based on a non-parametric filter approach and exploits the X-11 algorithm, while TRAMO-SEATS is parametric.</p>
<p>The main idea here is that a time series, depending on its characteristics, can be decomposed into trend, cycle, seasonal component and residual. That is:</p>
<p><span class="math display">\[
x_t  = T_t + C_t + S_t + I_t
\]</span></p>
<p>An alternative model is the multiplicative one, which is used when the variance of the time series is not constant but increases over time:</p>
<p><span class="math display">\[
x_t  = T_t\cdot C_t \cdot S_t \cdot I_t
\]</span>
or</p>
<p><span class="math display">\[
x_t  = T_t\cdot (1 + C_t) \cdot (1 + S_t) \cdot (1 + I_t)
\]</span>
For this example we use the X-13 procedure.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="rjdemetra-package.html#cb201-1" aria-hidden="true" tabindex="-1"></a>x13_model <span class="ot">&lt;-</span> <span class="fu">x13</span>(ipi_fr)</span></code></pre></div>
<p>We begin by plotting the series, and noting right away that the seasonal component is very strong: every year, during summer, industrial production in France is notably lower than during the rest of the year</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="rjdemetra-package.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Original series</span></span>
<span id="cb202-2"><a href="rjdemetra-package.html#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x13_model<span class="sc">$</span>final<span class="sc">$</span>series[,<span class="dv">1</span>])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>Next, the trend is recovered by means of an n-order polynomial smoothing procedure. This can be thought of as a simple approximation of the series’ shape.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="rjdemetra-package.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Trend of the series</span></span>
<span id="cb203-2"><a href="rjdemetra-package.html#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x13_model<span class="sc">$</span>final<span class="sc">$</span>series[,<span class="dv">3</span>])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>By subtracting the trend to the original series we are left with the seasonal component:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="rjdemetra-package.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Seasonal component</span></span>
<span id="cb204-2"><a href="rjdemetra-package.html#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x13_model<span class="sc">$</span>final<span class="sc">$</span>series[,<span class="dv">4</span>])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>At this stage, the seasonal components are averaged across every year to get the Seasonal Indices (one per month in our case).</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="rjdemetra-package.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Seasonal indices</span></span>
<span id="cb205-2"><a href="rjdemetra-package.html#cb205-2" aria-hidden="true" tabindex="-1"></a>seasonal_index <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(<span class="fu">matrix</span>(x13_model<span class="sc">$</span>final<span class="sc">$</span>series[,<span class="dv">4</span>], <span class="at">nrow =</span> <span class="dv">30</span>, <span class="at">ncol =</span> <span class="dv">12</span>, <span class="at">byrow =</span> T))</span></code></pre></div>
<pre><code>## Warning in matrix(x13_model$final$series[, 4], nrow = 30, ncol = 12, byrow = T): data length [372] is not a
## sub-multiple or multiple of the number of rows [30]</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="rjdemetra-package.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(seasonal_index, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<p>which repeated for every year gives</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="rjdemetra-package.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Overall period</span></span>
<span id="cb208-2"><a href="rjdemetra-package.html#cb208-2" aria-hidden="true" tabindex="-1"></a>seasonal_index_repeated <span class="ot">&lt;-</span> <span class="fu">rep</span>(seasonal_index, <span class="at">times =</span> <span class="dv">30</span>)</span>
<span id="cb208-3"><a href="rjdemetra-package.html#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(seasonal_index_repeated, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>By subtracting the last series to the original data we obtain the seasonally adjusted series (that is the series where the seasonal component has been removed).</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="rjdemetra-package.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Seasonally adjusted series</span></span>
<span id="cb209-2"><a href="rjdemetra-package.html#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x13_model<span class="sc">$</span>final<span class="sc">$</span>series[,<span class="dv">2</span>])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<p>Finally, this resulting series is newly approximated with the polynomial smoothing procedure and the difference between the seasonally adjusted series and this last result gives the residuals:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="rjdemetra-package.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals</span></span>
<span id="cb210-2"><a href="rjdemetra-package.html#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x13_model<span class="sc">$</span>final<span class="sc">$</span>series[,<span class="dv">5</span>])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
</div>
<div id="additional-output-and-forecast" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Additional output and forecast</h2>
<p><strong>M and Q statistics</strong></p>
<p>The X-13 function also provides the M-statistic and the Q-statistic. These can be found under the <code>decomposition</code> section of the output:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="rjdemetra-package.html#cb211-1" aria-hidden="true" tabindex="-1"></a>x13_model[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## $decomposition
## [1m Monitoring and Quality Assessment Statistics: [22m 
##       M stats
## M(1)    0.163
## M(2)    0.089
## M(3)    1.181
## M(4)    0.558
## M(5)    1.020
## M(6)    0.090
## M(7)    0.083
## M(8)    0.244
## M(9)    0.062
## M(10)   0.272
## M(11)   0.256
## Q       0.368
## Q-M2    0.402
## 
## Final filters: 
## Seasonal filter:  3x5
## Trend filter:  13 terms Henderson moving average</code></pre>
<p>The M-statistics are a set of 11 statistics that check the quality of the seasonal adjustment. Their value varies between 0 and 3 but only values smaller than 1 are considered acceptable. The statistics from M1 to M6 check the characteristics of the irregular component; M7 the presence of seasonality; M8 to M11 the stability of the seasonal component. The Q-statistics are linear combinations of the M-statistics that summarize in a single number all theis information on the decomposition.</p>
<p><strong>Filters</strong></p>
<p>Under the <code>decomposition</code> section it’s also possible to find the specification of the filters that have been used in the estimation of the different factors. These include seasonal filters and trend filters.</p>
<p>The main idea of a filter is that of smoothing the observations of a time series. This is usually done by replacing each original value with linear combinations of its adjacent values.</p>
<p>Trend filters smooth the original series to isolate stable trends in the data. For example, a 2x4 filter can be outlined as follows:</p>
$$
<span class="math display">\[\begin{aligned}
2002.1 &amp;+&amp; 2002.2 &amp;+&amp; 2002.3 &amp;+&amp; 2003.4 \\
&amp;&amp; 2002.2 &amp;+&amp; 2002.3 &amp;+&amp; 2002.4 &amp;+&amp; 2003.1\\

\hline
&amp;&amp; &amp;&amp; 8 &amp;&amp;   &amp;&amp; 
\end{aligned}\]</span>
<p>$$
2x4 in the above example refers to the number of “sliding windows” (2) and the number of observations in each window (4).</p>
<p>Seasonal filters are instead applied only to observations pertaining to the same season. For example, a 3x5 seasonal filter works as follows:</p>
<p><span class="math display">\[
\begin{aligned}
2002.1 &amp;+&amp; 2003.1 &amp;+&amp; 2004.1 &amp;+&amp; 2005.1 &amp;+&amp; 2006.1 \\
&amp;&amp; 2003.1 &amp;+&amp; 2004.1 &amp;+&amp; 2005.1 &amp;+&amp; 2006.1 &amp;+&amp; 2007.1 \\
&amp;&amp; &amp;&amp; 2004.1 &amp;+&amp; 2005.1 &amp;+&amp; 2006.1 &amp;+&amp; 2007.1 &amp;+&amp; 2008.1 \\
\hline
&amp;&amp; &amp;&amp; &amp;&amp;  15 &amp;&amp; &amp;&amp;
\end{aligned}
\]</span>
Here, the value of observation for the first quarter of 2005 is replaced with a linear combination of the previous and subsequent values of the series during the same season.</p>
<p><strong>Forecast</strong></p>
<p>The <code>Final</code> section of the X-13 function’s output lists the final part of the original series, its adjusted version and explicits the different components’ contribution (trend, seasonal, irregular) to each observation of the time series.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="rjdemetra-package.html#cb213-1" aria-hidden="true" tabindex="-1"></a>x13_model[<span class="dv">3</span>]</span></code></pre></div>
<pre><code>## $final
## Last observed values
##              y        sa        t            s             i
## Jan 2020 101.0 102.95613 102.9586  -1.95613209  -0.002494203
## Feb 2020 100.1 103.50876 102.9592  -3.40875640   0.549602816
## Mar 2020  91.8  82.87617 103.1664   8.92382800 -20.290271773
## Apr 2020  66.7  66.65243 103.5971   0.04756625 -36.944710027
## May 2020  73.7  78.87836 104.0393  -5.17835604 -25.160905985
## Jun 2020  98.2  87.34544 104.3804  10.85456021 -17.034985133
## Jul 2020  97.4  92.47436 104.5319   4.92563707 -12.057551871
## Aug 2020  71.7  97.47245 104.3751 -25.77244698  -6.902636199
## Sep 2020 104.7  97.37717 103.9182   7.32282919  -6.541070626
## Oct 2020 106.7  98.24194 103.3047   8.45805540  -5.062719500
## Nov 2020 101.6 100.26862 102.7746   1.33138152  -2.506014899
## Dec 2020  96.6  99.66730 102.5133  -3.06729670  -2.845961796
## 
## Forecasts:
##                y_f     sa_f      t_f          s_f        i_f
## Jan 2021  94.53021 101.0902 102.4794  -6.56002888 -1.3891608
## Feb 2021  97.90024 101.7395 102.5246  -3.83928384 -0.7850772
## Mar 2021 114.09983 102.3065 102.5087  11.79328397 -0.2021598
## Apr 2021 102.16781 102.2220 102.3759  -0.05422341 -0.1538967
## May 2021  96.01612 101.5450 102.2100  -5.52888123 -0.6650098
## Jun 2021 112.76658 101.3438 102.0725  11.42275939 -0.7286526
## Jul 2021 104.13805 101.6681 102.0297   2.46989932 -0.3615193
## Aug 2021  79.13003 102.3617 102.1360 -23.23171595  0.2257112
## Sep 2021 109.06438 102.4772 102.3249   6.58713572  0.1523168
## Oct 2021 108.64207 102.1329 102.5185   6.50921416 -0.3856588
## Nov 2021 106.46022 102.5908 102.6996   3.86943752 -0.1088338
## Dec 2021  99.79901 103.0831 102.8580  -3.28410831  0.2251086</code></pre>
<p>This section also provides forecast for a period after the last observations. This is based on the ARIMA model.</p>
<p><strong>Diagnostics</strong></p>
<p>The final part of the output of the X-13 function provides some additional statistics such as the Kruskall-Wallis test, the test for the presence of seasonality assuming stability, the Evolutive Seasonality test and Residual seasonality tests.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="illustrative-example.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/aciancetta/Euorostat-EMOS-TimeSeries/edit/master/04-seasonal_adjustment.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/aciancetta/Euorostat-EMOS-TimeSeries/blob/master/04-seasonal_adjustment.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
